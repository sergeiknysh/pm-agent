---
id: TASK-0004
title: "Inbox flow: append в pm/inbox.md + triage (создание task-файлов из строк)"
status: done
project: vextaibot
priority: P0
tags: [inbox]
created: 2026-01-30T23:32:54.278Z
updated: 2026-01-30T23:50:00.000Z
estimate: 4h
---

## Контекст

Нужен минимальный inbox-флоу:

1) быстро добавлять входящие строки в `pm/inbox.md`
2) запускать triage, который превращает bullet-строки из inbox в отдельные task-файлы в `pm/projects/<project>/tasks/`.

Требования:
- простой парсер bullet-строк
- дедупликация (не плодить одинаковые задачи)
- интерактивный и неинтерактивный режимы

## План реализации

### A) `inbox add`
- гарантировать наличие `pm/inbox.md` (создать шаблон если нет)
- добавить строку как `- <text>`
- поддерживать удобный «пустой bullet» `- ` в конце файла (перезаписывать/восстанавливать)

### B) `inbox triage`
- парсинг bullet-строк (`- ...` или `- [ ] ...`), игнор пустых
- считать строки уже обработанными если:
  - есть `[x]`, или
  - в тексте встречается `TASK-xxxx`
- поддержка inline-hints:
  - `@project` или `p:project`
  - `#tag`
  - `P0..P3`
  - `due:YYYY-MM-DD`
- дедуп:
  - в рамках запуска: одинаковые нормализованные строки пропускать
  - против уже существующих задач: если title совпадает (нормализованно) → пометить как duplicate
- создание task-файла:
  - следующий `TASK-xxxx` по максимальному id в `tasks/`
  - filename: `TASK-0001-<slug>.md`
  - frontmatter по Task Spec v1
  - тело с шаблоном (Контекст/Чеклист/Лог)
- обновление `pm/inbox.md`:
  - заменить строку на `- [x] <text> (→ TASK-xxxx)`

### C) Режимы
- интерактивный (по умолчанию):
  - подтверждение создания каждой задачи
  - при необходимости промптить priority/due/tags
- неинтерактивный:
  - `--non-interactive` (не спрашивать; использовать defaults/inline/flags)
  - `--yes` (принять дефолты и создавать без подтверждений)
- вспомогательно: `--dry-run`

## Прогресс/Чеклист

- [x] Добавлен минимальный CLI `pm/bin/pm.js`
- [x] `pm inbox add <text>`: append в `pm/inbox.md`
- [x] `pm inbox triage`: парсинг bullet-строк и создание task-файлов
- [x] Inline-hints: `@project`, `p:project`, `#tag`, `P0..P3`, `due:`
- [x] Дедуп: внутри запуска и против существующих задач (по title)
- [x] Inbox-marking: `- [x] ... (→ TASK-xxxx)` / `(duplicate)`
- [ ] (опционально) дока в `pm/README.md` + примеры

## Лог
- 2026-01-30T23:32:54.278Z: создано планом
- 2026-01-30T23:50:00.000Z: реализован минимальный CLI для inbox add/triage
